#!/bin/bash
## @licence AGPLv3 <https://www.gnu.org/licenses/agpl-3.0.html>
## @author Copyright (C) 2015 Robin Schneider <ypid@riseup.net>

source "$OPENVPN/ovpn_env.sh"

TARGET="/tmp/openvpn_${OVPN_CN}"
if [ -n "$1" ]; then
    TARGET="$1"
fi

rsync --recursive --verbose --prune-empty-dirs \
    --include "*/" \
    --include "/pki/private/${OVPN_CN}.key" \
    --include "/pki/ca.crt" \
    --include "/pki/issued/${OVPN_CN}.crt" \
    --include "/pki/dh.pem" \
    --include "ta.key" \
    --include "/openvpn.conf" \
    --include "/ovpn_env.sh" \
    --exclude="*" \
    "$OPENVPN/" "$TARGET"

echo "Created the openvpn configuration for the server: $TARGET"
